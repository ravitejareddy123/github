<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Microservice Pipeline Monitor</title>
  https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js
  https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js
  https://cdn.jsdelivr.net/npm/babel-standalone@7/babel.min.js
  https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js
</head>
<body>
  <div id="root"></div>

  <script type="text/javascript">
    var gk_isXlsx = false;
    var gk_xlsxFileLookup = {};
    var gk_fileData = {};

    function filledCell(cell) {
      return cell !== '' && cell != null;
    }

    function loadFileData(filename) {
      if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
        try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row => row.some(filledCell));
          var headerRowIndex = filteredData.findIndex((row, index) =>
            row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
          );
          if (headerRowIndex === -1 || headerRowIndex > 25) {
            headerRowIndex = 0;
          }
          var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
        } catch (e) {
          console.error(e);
          return "";
        }
      }
      return gk_fileData[filename] || "";
    }
  </script>

  <script type="text/babel">
    function App() {
      const [query, setQuery] = React.useState('');
      const [response, setResponse] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState(null);
      const [report, setReport] = React.useState('');
      const canvasRef = React.useRef(null);

      const mockResponses = {
        "What happened to my microservice?": {
          message: `Microservice Status: Running
Build: Success
Test: Success
Deploy: Success, pod status: Running
Logs: 10% error rate detected
Issues: High error rate
Mitigations: Check microservice code`
        },
        "What is the login status of my microservice?": {
          message: `Login Status: Functional
Logs: 5 login failures detected
Mitigations: Verify login credentials and form handling`
        }
      };

      React.useEffect(() => {
        fetch('/<your-repo>/log_analysis_report.md')
          .then(res => res.text())
          .then(data => setReport(data))
          .catch(err => setError('Failed to load report'));

        const ctx = canvasRef.current.getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Total Logs', 'Errors', 'Warnings', 'Login Failures'],
            datasets: [{
              label: 'Log Metrics',
              data: [50, 5, 10, 5],
              backgroundColor: ['#2563eb', '#dc2626', '#f59e0b', '#16a34a'],
              borderColor: ['#1e40af', '#991b1b', '#b45309', '#15803d'],
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: { beginAtZero: true, title: { display: true, text: 'Count' } },
              x: { title: { display: true, text: 'Metric' } }
            }
          }
        });
      }, []);

      const handleQuery = () => {
        setLoading(true);
        setError(null);
        setTimeout(() => {
          const mockResponse = mockResponses[query] || {
            message: 'Query not recognized. Try: "What happened to my microservice?" or "What is the login status of my microservice?"'
          };
          setResponse(mockResponse.message);
          setLoading(false);
        }, 1000);
      };

      return (
        <div className="container mx-auto p-4">
          <h1 className="text-2xl font-bold mb-4">Microservice Pipeline Monitor</h1>
          <div className="mb-4">
            <input
              type="text"
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              placeholder="e.g., What happened to my microservice?"
              className="border p-2 w-full mb-2 rounded"
            />
            <button
              onClick={handleQuery}
              className="bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
              disabled={loading}
            >
              {loading ? 'Processing...' : 'Submit Query'}
            </button>
          </div>
          {error && <p className="text-red-500">{error}</p>}
          {response && (
            <div className="border p-4 rounded bg-gray-100 mb-4">
              <h2 className="text-xl font-semibold mb-2">Response</h2>
              <pre className="whitespace-pre-wrap">{response}</pre>
            </div>
          )}
          <div className="border p-4 rounded bg-gray-100 mb-4">
            <h2 className="text-xl font-semibold mb-2">Log Analysis Report</h2>
            <pre className="whitespace-pre-wrap">{report}</pre>
          </div>
          <div className="border p-4 rounded bg-gray-100">
            <h2 className="text-xl font-semibold mb-2">Log Metrics</h2>
            <canvas ref={canvasRef} width="400" height="200"></canvas>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
